version: '2'
services:
    nginx:
        build: ./nginx
        volumes:
        - ./nginx/nginx/:/etc/nginx
        ports:
        - "80:80"
        depends_on:
        - nodered

    nodered:
        build: ./node-red
        ports:
        - "1880:1880"
        volumes:
        - ./node-red/src:/src
        depends_on:
        - storage

    storage:
        build: ./storage-api
        ports:
        - "8100:8100"
        depends_on:
        - mongodb

    mongodb:
        image: mongo
        ports:
        - "27017:27017"
    
    mqtt:
        build: ./mqtt
        volumes:
        - ./mqtt/:/etc/mosquitto